<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>4D Шифр (x,y,z,wx,wy,wz)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #0f0f0f; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; }
        .panel { background: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        button { background: #d32f2f; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        textarea, input { width: 100%; padding: 10px; margin: 5px 0; background: #333; color: #fff; border: 1px solid #444; border-radius: 5px; }
        .cubes { display: flex; gap: 20px; margin-top: 30px; }
        .cube-container { flex: 1; height: 400px; background: #000; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #444; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h1>4D Шифр (x,y,z,wx,wy,wz) - 54 символа</h1>
        
        <div class="panel">
            <h2>Управление</h2>
            <textarea id="input-text" rows="3">SECRET MESSAGE</textarea>
            
            <div style="display: flex; gap: 10px;">
                <input type="text" id="key1" placeholder="Ключ для Куба 1" value="MASTER_KEY_1">
                <input type="text" id="key2" placeholder="Ключ для Куба 2" value="MASTER_KEY_2">
            </div>
            
            <div>
                <button onclick="encrypt()">Зашифровать</button>
                <button onclick="decrypt()">Расшифровать</button>
                <button onclick="initSystem()">Инициализировать систему</button>
            </div>
        </div>
        
        <div class="panel">
            <h2>Результат</h2>
            <div id="output" style="min-height: 50px; padding: 10px; background: #222; border-radius: 5px;"></div>
        </div>
        
        <div class="cubes">
            <div class="cube-container" id="cube1-display"></div>
            <div class="cube-container" id="cube2-display"></div>
        </div>
        
        <div class="panel">
            <h2>Таблица символов (54 символа)</h2>
            <table id="symbol-table">
                <thead>
                    <tr>
                        <th>Символ</th>
                        <th>Куб1 (x,y,z)</th>
                        <th>Куб2 (wx,wy,wz)</th>
                        <th>4D-код</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let cube1 = [], cube2 = [];
        let scene1, scene2, camera1, camera2, renderer1, renderer2;
        const ALPHABET = generateAlphabet();
        
        // Генерация алфавита (54 символа)
        function generateAlphabet() {
            let alphabet = [];
            // A-Z
            for(let i=65; i<=90; i++) alphabet.push(String.fromCharCode(i));
            // 0-9
            for(let i=48; i<=57; i++) alphabet.push(String.fromCharCode(i));
            // Спецсимволы
            alphabet.push('!','@','#','$','%','^','&','*','(',')','-','+','=');
            return alphabet.slice(0,54);
        }
        
        // Инициализация системы
        function initSystem() {
            const key1 = document.getElementById('key1').value;
            const key2 = document.getElementById('key2').value;
            
            // Создаем кубы 3x3x3 (27 позиций)
            cube1 = createCube(key1);
            cube2 = createCube(key2);
            
            // Инициализация 3D визуализации
            init3DVisualization();
            
            // Обновление таблицы символов
            updateSymbolTable();
            
            document.getElementById('output').innerHTML = "Система инициализирована с 54 символами";
        }
        
        // Создание куба с перемешиванием
        function createCube(key) {
            // Создаем перемешанный алфавит на основе ключа
            let shuffled = [...ALPHABET];
            for(let i=shuffled.length-1; i>0; i--) {
                const keyIndex = i % key.length;
                const keyChar = key.charCodeAt(keyIndex);
                const j = (keyChar * (i+1)) % (i+1);
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // Заполняем 3D куб 3x3x3
            let cube = [];
            let index = 0;
            for(let x=0; x<3; x++) {
                cube[x] = [];
                for(let y=0; y<3; y++) {
                    cube[x][y] = [];
                    for(let z=0; z<3; z++) {
                        cube[x][y][z] = shuffled[index++ % shuffled.length];
                    }
                }
            }
            return cube;
        }
        
        // 3D визуализация кубов
        function init3DVisualization() {
            // Очистка предыдущих сцен
            document.getElementById('cube1-display').innerHTML = '';
            document.getElementById('cube2-display').innerHTML = '';
            
            // Инициализация Three.js сцен
            [scene1, renderer1] = createScene('cube1-display', 0xff4444);
            [scene2, renderer2] = createScene('cube2-display', 0x4444ff);
            
            // Камеры
            camera1 = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera1.position.set(4,4,4);
            camera1.lookAt(0,0,0);
            
            camera2 = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera2.position.set(4,4,4);
            camera2.lookAt(0,0,0);
            
            // Создание визуализации кубов
            createCubeMesh(scene1, cube1, 0xff4444);
            createCubeMesh(scene2, cube2, 0x4444ff);
            
            // Анимация
            animate();
        }
        
        function createScene(containerId, color) {
            const container = document.getElementById(containerId);
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            const scene = new THREE.Scene();
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);
            
            // Освещение
            const light = new THREE.DirectionalLight(color, 1);
            light.position.set(1,1,1);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x333333));
            
            return [scene, renderer];
        }
        
        function createCubeMesh(scene, cube, color) {
            const size = 0.9;
            const gap = 0.1;
            
            for(let x=0; x<3; x++) {
                for(let y=0; y<3; y++) {
                    for(let z=0; z<3; z++) {
                        const geometry = new THREE.BoxGeometry(size, size, size);
                        const material = new THREE.MeshPhongMaterial({ 
                            color: color,
                            transparent: true,
                            opacity: 0.8
                        });
                        
                        const mesh = new THREE.Mesh(geometry, material);
                        mesh.position.set(
                            x-1 + (x-1)*gap,
                            y-1 + (y-1)*gap,
                            z-1 + (z-1)*gap
                        );
                        
                        scene.add(mesh);
                    }
                }
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if(scene1 && scene2) {
                scene1.rotation.y += 0.005;
                scene2.rotation.x += 0.005;
                
                renderer1.render(scene1, camera1);
                renderer2.render(scene2, camera2);
            }
        }
        
        // Обновление таблицы символов
        function updateSymbolTable() {
            const tableBody = document.querySelector('#symbol-table tbody');
            tableBody.innerHTML = '';
            
            ALPHABET.forEach(char => {
                const coords1 = findInCube(char, cube1);
                const coords2 = findInCube(char, cube2);
                
                if(coords1 && coords2) {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${char}</td>
                        <td>${coords1.join(',')}</td>
                        <td>${coords2.join(',')}</td>
                        <td>${coords1.concat(coords2).join(',')}</td>
                    `;
                    
                    tableBody.appendChild(row);
                }
            });
        }
        
        // Поиск символа в кубе
        function findInCube(char, cube) {
            for(let x=0; x<3; x++) {
                for(let y=0; y<3; y++) {
                    for(let z=0; z<3; z++) {
                        if(cube[x][y][z] === char) {
                            return [x,y,z];
                        }
                    }
                }
            }
            return null;
        }
        
        // Шифрование
        function encrypt() {
            const text = document.getElementById('input-text').value.toUpperCase();
            let result = '';
            
            for(let char of text) {
                const coords1 = findInCube(char, cube1);
                const coords2 = findInCube(char, cube2);
                
                if(coords1 && coords2) {
                    result += `${coords1.concat(coords2).join(',')} `;
                } else {
                    result += `[${char}?] `;
                }
            }
            
            document.getElementById('output').innerHTML = `
                <strong>Исходный текст:</strong> ${text}<br>
                <strong>Шифротекст:</strong> ${result.trim()}
            `;
        }
        
        // Дешифрование
        function decrypt() {
            const input = document.getElementById('input-text').value.trim();
            const codes = input.split(' ');
            let result = '';
            
            for(let code of codes) {
                const coords = code.split(',').map(Number);
                if(coords.length === 6) {
                    const [x,y,z,wx,wy,wz] = coords;
                    if(x>=0 && x<3 && y>=0 && y<3 && z>=0 && z<3) {
                        result += cube1[x][y][z];
                    } else {
                        result += '?';
                    }
                } else {
                    result += '?';
                }
            }
            
            document.getElementById('output').innerHTML = `
                <strong>Шифротекст:</strong> ${input}<br>
                <strong>Расшифрованный текст:</strong> ${result}
            `;
        }
        
        // Инициализация при загрузке
        window.onload = initSystem;
    </script>
</body>
</html>
