<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True 4×4×4 Trifid Cipher Implementation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .grid-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        .cube-layer {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        .grid-cell {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            min-width: 30px;
        }
        .grid-header {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
        }
        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-family: monospace;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .step {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f0f7fc;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .coordinates {
            font-family: monospace;
            white-space: pre;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #ecf0f1;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .alphabet-validation {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .visualization {
            margin-top: 20px;
        }
        .process-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .process-table th, .process-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .process-table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>True 4×4×4 Trifid Cipher Implementation</h1>
        <p>This is a complete implementation of the actual Trifid cipher using a 4×4×4 cube (64 symbols + filler)</p>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('settings')">Settings</div>
            <div class="tab" onclick="switchTab('encrypt')">Encrypt</div>
            <div class="tab" onclick="switchTab('decrypt')">Decrypt</div>
            <div class="tab" onclick="switchTab('about')">About</div>
        </div>
        
        <div id="settings" class="tab-content active">
            <h2>Cipher Settings</h2>
            <div>
                <p>Enter exactly 64 unique characters for the 4×4×4 cube:</p>
                <textarea id="alphabet" rows="3">ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz@#$%^&amp;*()-+=</textarea>
                <p>Filler character (must NOT be in alphabet):</p>
                <input type="text" id="filler" value="-" maxlength="1">
                <button onclick="initCube()">Initialize Cube</button>
                <div id="alphabetStatus" class="alphabet-validation"></div>
            </div>
            
            <div id="cubeVisualization">
                <h3>Current Cube Visualization</h3>
                <div id="cubeLayers" class="grid-container"></div>
            </div>
        </div>
        
        <div id="encrypt" class="tab-content">
            <h2>Encryption</h2>
            <div>
                <textarea id="plaintext" placeholder="Enter text to encrypt"></textarea>
                <button onclick="encrypt()">Encrypt</button>
                <button onclick="document.getElementById('plaintext').value = ''">Clear</button>
                
                <div id="encryptionResult" class="step" style="display: none;">
                    <h3>Encryption Result</h3>
                    <p><strong>Ciphertext:</strong> <span id="ciphertextOutput"></span></p>
                </div>
                
                <div id="encryptionSteps" class="visualization"></div>
            </div>
        </div>
        
        <div id="decrypt" class="tab-content">
            <h2>Decryption</h2>
            <div>
                <textarea id="ciphertext" placeholder="Enter text to decrypt"></textarea>
                <button onclick="decrypt()">Decrypt</button>
                <button onclick="document.getElementById('ciphertext').value = ''">Clear</button>
                
                <div id="decryptionResult" class="step" style="display: none;">
                    <h3>Decryption Result</h3>
                    <p><strong>Plaintext:</strong> <span id="plaintextOutput"></span></p>
                </div>
                
                <div id="decryptionSteps" class="visualization"></div>
            </div>
        </div>
        
        <div id="about" class="tab-content">
            <h2>About the 4×4×4 Trifid Cipher</h2>
            <div class="step">
                <h3>How the True Trifid Cipher Works</h3>
                <p>The Trifid cipher is a classical cipher that uses three 4×4 squares (forming a 4×4×4 cube) for encryption. Unlike simple substitution, it provides more security through coordinate manipulation.</p>
                
                <h4>Encryption Process:</h4>
                <ol>
                    <li>Each character is mapped to its (layer, row, column) coordinates in the cube</li>
                    <li>All coordinates are written in three separate streams:
                        <ul>
                            <li>Layer numbers</li>
                            <li>Row numbers</li>
                            <li>Column numbers</li>
                        </ul>
                    </li>
                    <li>The three streams are concatenated (layers + rows + columns)</li>
                    <li>The combined stream is split into triplets (layer, row, column)</li>
                    <li>Each triplet is converted back to a character</li>
                </ol>
                
                <h4>Decryption Process:</h4>
                <ol>
                    <li>Each character is converted back to its (layer, row, column) coordinates</li>
                    <li>All coordinates are written as a single long sequence</li>
                    <li>The sequence is split into three equal parts:
                        <ul>
                            <li>First part contains layer numbers</li>
                            <li>Second part contains row numbers</li>
                            <li>Third part contains column numbers</li>
                        </ul>
                    </li>
                    <li>The original coordinates are reconstructed by combining corresponding numbers</li>
                    <li>Each coordinate triplet is converted back to the original character</li>
                </ol>
                
                <h4>Key Features of This Implementation:</h4>
                <ul>
                    <li>True 4×4×4 cube structure (64 symbols + filler)</li>
                    <li>Complete implementation of the actual Trifid algorithm</li>
                    <li>Full visualization of each step</li>
                    <li>Input validation and error handling</li>
                    <li>Configurable alphabet and filler character</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let trifidCube = []; // 3D array [layer][row][column]
        let alphabet = "";
        let fillerChar = "-";
        
        // Initialize the 4×4×4 cube
        function initCube() {
            const alphabetInput = document.getElementById('alphabet').value;
            const newFiller = document.getElementById('filler').value;
            const statusElement = document.getElementById('alphabetStatus');
            
            // Validate alphabet length
            if (alphabetInput.length !== 64) {
                statusElement.innerHTML = `<span class="error">Error: Alphabet must be exactly 64 characters long (current: ${alphabetInput.length})</span>`;
                return;
            }
            
            // Check for duplicates
            const uniqueChars = new Set(alphabetInput);
            if (uniqueChars.size !== alphabetInput.length) {
                statusElement.innerHTML = `<span class="error">Error: Alphabet contains duplicate characters</span>`;
                return;
            }
            
            // Validate filler
            if (newFiller.length !== 1) {
                statusElement.innerHTML = `<span class="error">Error: Filler must be exactly 1 character</span>`;
                return;
            }
            
            if (alphabetInput.includes(newFiller)) {
                statusElement.innerHTML = `<span class="error">Error: Filler character must NOT be in the alphabet</span>`;
                return;
            }
            
            // Update global variables
            alphabet = alphabetInput;
            fillerChar = newFiller;
            
            // Build the cube
            trifidCube = [];
            let charIndex = 0;
            
            for (let layer = 0; layer < 4; layer++) {
                const currentLayer = [];
                for (let row = 0; row < 4; row++) {
                    const currentRow = [];
                    for (let col = 0; col < 4; col++) {
                        if (charIndex < alphabet.length) {
                            currentRow.push(alphabet[charIndex++]);
                        } else {
                            currentRow.push(fillerChar);
                        }
                    }
                    currentLayer.push(currentRow);
                }
                trifidCube.push(currentLayer);
            }
            
            statusElement.innerHTML = `<span class="success">Cube initialized successfully with 64 characters + filler</span>`;
            visualizeCube();
        }
        
        // Visualize the cube
        function visualizeCube() {
            const container = document.getElementById('cubeLayers');
            container.innerHTML = '';
            
            for (let layer = 0; layer < 4; layer++) {
                const layerDiv = document.createElement('div');
                layerDiv.className = 'cube-layer';
                layerDiv.innerHTML = `<h4>Layer ${layer + 1}</h4>`;
                
                const grid = document.createElement('div');
                grid.className = 'grid';
                
                // Add header row
                const headerRow = document.createElement('div');
                headerRow.className = 'grid-cell grid-header';
                headerRow.textContent = 'R\C';
                grid.appendChild(headerRow);
                
                for (let col = 0; col < 4; col++) {
                    const headerCell = document.createElement('div');
                    headerCell.className = 'grid-cell grid-header';
                    headerCell.textContent = col + 1;
                    grid.appendChild(headerCell);
                }
                
                // Add grid content
                for (let row = 0; row < 4; row++) {
                    const rowHeader = document.createElement('div');
                    rowHeader.className = 'grid-cell grid-header';
                    rowHeader.textContent = row + 1;
                    grid.appendChild(rowHeader);
                    
                    for (let col = 0; col < 4; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell';
                        cell.textContent = trifidCube[layer][row][col];
                        grid.appendChild(cell);
                    }
                }
                
                layerDiv.appendChild(grid);
                container.appendChild(layerDiv);
            }
        }
        
        // Find coordinates of a character in the cube
        function findCoordinates(char) {
            for (let layer = 0; layer < 4; layer++) {
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (trifidCube[layer][row][col] === char) {
                            return { layer: layer + 1, row: row + 1, col: col + 1 };
                        }
                    }
                }
            }
            return null; // Character not found
        }
        
        // Get character from coordinates
        function getCharFromCoordinates(layer, row, col) {
            if (layer < 1 || layer > 4 || row < 1 || row > 4 || col < 1 || col > 4) {
                return fillerChar;
            }
            return trifidCube[layer - 1][row - 1][col - 1];
        }
        
        // Encrypt plaintext
        function encrypt() {
            const plaintext = document.getElementById('plaintext').value;
            if (!plaintext) {
                alert("Please enter some text to encrypt");
                return;
            }
            
            // Prepare visualization
            let stepsHTML = `
                <div class="step">
                    <h3>Step 1: Prepare Plaintext</h3>
                    <p>Original plaintext: ${plaintext}</p>
                    <p>Processing each character...</p>
                </div>
            `;
            
            // Step 1: Convert each character to coordinates
            let coordinates = [];
            let coordTable = `
                <div class="step">
                    <h3>Step 2: Convert Characters to Coordinates</h3>
                    <table class="process-table">
                        <tr>
                            <th>Character</th>
                            <th>Layer</th>
                            <th>Row</th>
                            <th>Column</th>
                        </tr>
            `;
            
            for (let char of plaintext) {
                const coord = findCoordinates(char);
                if (coord) {
                    coordinates.push(coord);
                    coordTable += `
                        <tr>
                            <td>${char}</td>
                            <td>${coord.layer}</td>
                            <td>${coord.row}</td>
                            <td>${coord.col}</td>
                        </tr>
                    `;
                } else {
                    // Skip characters not in cube
                }
            }
            coordTable += `</table></div>`;
            stepsHTML += coordTable;
            
            // Step 2: Create three streams
            let layersStream = coordinates.map(c => c.layer).join('');
            let rowsStream = coordinates.map(c => c.row).join('');
            let colsStream = coordinates.map(c => c.col).join('');
            let combinedStream = layersStream + rowsStream + colsStream;
            
            stepsHTML += `
                <div class="step">
                    <h3>Step 3: Create Coordinate Streams</h3>
                    <p>Layers stream: ${layersStream}</p>
                    <p>Rows stream: ${rowsStream}</p>
                    <p>Columns stream: ${colsStream}</p>
                    <p>Combined stream: ${combinedStream}</p>
                </div>
            `;
            
            // Step 3: Split into triplets and convert back to characters
            let ciphertext = '';
            let tripletTable = `
                <div class="step">
                    <h3>Step 4: Regroup into Triplets</h3>
                    <table class="process-table">
                        <tr>
                            <th>Triplet</th>
                            <th>Layer</th>
                            <th>Row</th>
                            <th>Column</th>
                            <th>Character</th>
                        </tr>
            `;
            
            for (let i = 0; i < combinedStream.length; i += 3) {
                let triplet = combinedStream.substr(i, 3);
                if (triplet.length === 3) {
                    const layer = parseInt(triplet[0]);
                    const row = parseInt(triplet[1]);
                    const col = parseInt(triplet[2]);
                    const char = getCharFromCoordinates(layer, row, col);
                    ciphertext += char;
                    
                    tripletTable += `
                        <tr>
                            <td>${triplet}</td>
                            <td>${layer}</td>
                            <td>${row}</td>
                            <td>${col}</td>
                            <td>${char}</td>
                        </tr>
                    `;
                } else {
                    // Handle incomplete triplet (shouldn't happen with proper implementation)
                    ciphertext += fillerChar;
                }
            }
            tripletTable += `</table></div>`;
            stepsHTML += tripletTable;
            
            // Display results
            document.getElementById('encryptionResult').style.display = 'block';
            document.getElementById('ciphertextOutput').textContent = ciphertext;
            document.getElementById('encryptionSteps').innerHTML = stepsHTML;
        }
        
        // Decrypt ciphertext
        function decrypt() {
            const ciphertext = document.getElementById('ciphertext').value;
            if (!ciphertext) {
                alert("Please enter some text to decrypt");
                return;
            }
            
            // Prepare visualization
            let stepsHTML = `
                <div class="step">
                    <h3>Step 1: Prepare Ciphertext</h3>
                    <p>Original ciphertext: ${ciphertext}</p>
                    <p>Processing each character...</p>
                </div>
            `;
            
            // Step 1: Convert each character to coordinates
            let coordinates = [];
            let coordTable = `
                <div class="step">
                    <h3>Step 2: Convert Characters to Coordinates</h3>
                    <table class="process-table">
                        <tr>
                            <th>Character</th>
                            <th>Layer</th>
                            <th>Row</th>
                            <th>Column</th>
                        </tr>
            `;
            
            for (let char of ciphertext) {
                const coord = findCoordinates(char);
                if (coord) {
                    coordinates.push(coord);
                    coordTable += `
                        <tr>
                            <td>${char}</td>
                            <td>${coord.layer}</td>
                            <td>${coord.row}</td>
                            <td>${coord.col}</td>
                        </tr>
                    `;
                } else {
                    // Skip characters not in cube
                }
            }
            coordTable += `</table></div>`;
            stepsHTML += coordTable;
            
            // Step 2: Create coordinate sequence
            let coordSequence = '';
            for (let coord of coordinates) {
                coordSequence += coord.layer + '' + coord.row + '' + coord.col;
            }
            
            stepsHTML += `
                <div class="step">
                    <h3>Step 3: Create Coordinate Sequence</h3>
                    <p>Full coordinate sequence: ${coordSequence}</p>
                </div>
            `;
            
            // Step 3: Split into three equal parts
            const partLength = Math.floor(coordSequence.length / 3);
            const layersPart = coordSequence.substring(0, partLength);
            const rowsPart = coordSequence.substring(partLength, 2 * partLength);
            const colsPart = coordSequence.substring(2 * partLength);
            
            stepsHTML += `
                <div class="step">
                    <h3>Step 4: Split into Three Parts</h3>
                    <p>Layers part: ${layersPart}</p>
                    <p>Rows part: ${rowsPart}</p>
                    <p>Columns part: ${colsPart}</p>
                </div>
            `;
            
            // Step 4: Reconstruct original coordinates
            let plaintext = '';
            let reconstructionTable = `
                <div class="step">
                    <h3>Step 5: Reconstruct Original Coordinates</h3>
                    <table class="process-table">
                        <tr>
                            <th>Position</th>
                            <th>Layer</th>
                            <th>Row</th>
                            <th>Column</th>
                            <th>Character</th>
                        </tr>
            `;
            
            for (let i = 0; i < layersPart.length; i++) {
                const layer = parseInt(layersPart[i]);
                const row = parseInt(rowsPart[i]);
                const col = parseInt(colsPart[i]);
                const char = getCharFromCoordinates(layer, row, col);
                plaintext += char;
                
                reconstructionTable += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${layer}</td>
                        <td>${row}</td>
                        <td>${col}</td>
                        <td>${char}</td>
                    </tr>
                `;
            }
            reconstructionTable += `</table></div>`;
            stepsHTML += reconstructionTable;
            
            // Display results
            document.getElementById('decryptionResult').style.display = 'block';
            document.getElementById('plaintextOutput').textContent = plaintext;
            document.getElementById('decryptionSteps').innerHTML = stepsHTML;
        }
        
        // Switch tabs
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Initialize on page load
        window.onload = function() {
            initCube();
        };
    </script>
</body>
</html>
