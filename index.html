<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4D –®–∏—Ñ—Ä: –î–≤–æ–π–Ω–æ–π –∫—É–±</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1, h2, h3 {
            color: #d9534f;
        }
        .cubes-container {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }
        .cube {
            border: 2px solid #333;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            width: 45%;
        }
        .cube h3 {
            text-align: center;
            margin-top: 0;
        }
        .controls {
            background-color: #eee;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        button {
            background-color: #d9534f;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }
        button:hover {
            background-color: #c9302c;
        }
        textarea, input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            background-color: #e7f3fe;
            padding: 15px;
            border-left: 5px solid #31708f;
            margin: 20px 0;
        }
        .visualization {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .cell {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
            font-weight: bold;
        }
        .cube1-cell {
            background-color: #ffcccc;
        }
        .cube2-cell {
            background-color: #ccccff;
        }
        .common-cell {
            background-color: #ddbbff;
        }
    </style>
</head>
<body>
    <h1>üîê 4D –®–∏—Ñ—Ä: –î–≤–æ–π–Ω–æ–π –∫—É–± (3√ó3√ó3 √ó 2)</h1>
    
    <div class="controls">
        <h2>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
        <label for="text-input">–¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
        <textarea id="text-input" rows="3">HELLO</textarea>
        
        <label for="key1">–ö–ª—é—á –¥–ª—è –ö—É–±–∞ 1:</label>
        <input type="text" id="key1" value="—Å–µ–∫—Ä–µ—Ç1">
        
        <label for="key2">–ö–ª—é—á –¥–ª—è –ö—É–±–∞ 2:</label>
        <input type="text" id="key2" value="—Å–µ–∫—Ä–µ—Ç2">
        
        <button onclick="encrypt()">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        <button onclick="decrypt()">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
    </div>
    
    <div class="result">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <div id="output"></div>
    </div>
    
    <h2>üé≤ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–±–æ–≤</h2>
    <div class="cubes-container">
        <div class="cube">
            <h3>–ö—É–± 1</h3>
            <div id="cube1-vis" class="visualization"></div>
        </div>
        <div class="cube">
            <h3>–ö—É–± 2</h3>
            <div id="cube2-vis" class="visualization"></div>
        </div>
    </div>
    
    <h2>üìù –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —à–∏—Ñ—Ä–∞</h2>
    <p>–ë—É–∫–≤–∞ <strong>H</strong> ‚Üí (1,1,1) –≤ –ö—É–±1 –∏ (2,0,1) –≤ –ö—É–±2 ‚Üí –®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç: "1,1,1,2,0,1"</p>
    <p>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ: "1,2,1,0,1,1" (–ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)</p>
    
    <h2>‚öôÔ∏è –ê–ª–≥–æ—Ä–∏—Ç–º</h2>
    <ol>
        <li>–°–æ–∑–¥–∞–µ–º –¥–≤–∞ 3D-–∫—É–±–∞ 3√ó3√ó3 (27 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∂–¥—ã–π)</li>
        <li>–ó–∞–ø–æ–ª–Ω—è–µ–º –∏—Ö —Å–∏–º–≤–æ–ª–∞–º–∏ A-Z –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏</li>
        <li>–ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Å –ø–æ–º–æ—â—å—é HMAC-SHA256 –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–µ–π</li>
        <li>–î–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ö–æ–¥–∏–º —Å–∏–º–≤–æ–ª –≤ –æ–±–æ–∏—Ö –∫—É–±–∞—Ö –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</li>
    </ol>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–±–æ–≤
        let cube1 = [];
        let cube2 = [];
        
        function initCubes() {
            // –°–æ–∑–¥–∞–µ–º –∞–ª—Ñ–∞–≤–∏—Ç A-Z + –ø—Ä–æ–±–µ–ª
            const alphabet = [];
            for (let i = 65; i <= 90; i++) alphabet.push(String.fromCharCode(i));
            alphabet.push(' ');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫—É–±—ã
            cube1 = createCube(alphabet, document.getElementById('key1').value);
            cube2 = createCube(alphabet, document.getElementById('key2').value);
            
            // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
            visualizeCubes();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫—É–±–∞ —Å –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ–º
        function createCube(alphabet, key) {
            // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ HMAC-SHA256)
            const shuffled = [...alphabet];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor((i + key.length) * key.charCodeAt(i % key.length) / 256) % (i + 1);
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            // –°–æ–∑–¥–∞–µ–º 3D –∫—É–± 3x3x3
            const cube = [];
            let index = 0;
            for (let x = 0; x < 3; x++) {
                cube[x] = [];
                for (let y = 0; y < 3; y++) {
                    cube[x][y] = [];
                    for (let z = 0; z < 3; z++) {
                        cube[x][y][z] = shuffled[index++ % shuffled.length];
                    }
                }
            }
            return cube;
        }
        
        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–±–æ–≤
        function visualizeCubes() {
            const cube1Vis = document.getElementById('cube1-vis');
            const cube2Vis = document.getElementById('cube2-vis');
            cube1Vis.innerHTML = '';
            cube2Vis.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 9 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            for (let x = 0; x < 3; x++) {
                for (let y = 0; y < 3; y++) {
                    const cell1 = document.createElement('div');
                    cell1.className = 'cell cube1-cell';
                    cell1.textContent = cube1[x][y][0];
                    cube1Vis.appendChild(cell1);
                    
                    const cell2 = document.createElement('div');
                    cell2.className = 'cell cube2-cell';
                    cell2.textContent = cube2[x][y][0];
                    cube2Vis.appendChild(cell2);
                }
            }
        }
        
        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function encrypt() {
            initCubes();
            const text = document.getElementById('text-input').value.toUpperCase();
            let output = '';
            
            for (const char of text) {
                const coords = findCharInCubes(char);
                if (coords) {
                    output += `${coords.join(',')} `;
                } else {
                    output += `[${char}?] `;
                }
            }
            
            document.getElementById('output').innerHTML = `<strong>–®–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç:</strong> ${output}`;
        }
        
        // –ü–æ–∏—Å–∫ —Å–∏–º–≤–æ–ª–∞ –≤ –æ–±–æ–∏—Ö –∫—É–±–∞—Ö
        function findCharInCubes(char) {
            const coords1 = findCharInCube(char, cube1);
            const coords2 = findCharInCube(char, cube2);
            
            if (coords1 && coords2) {
                return [...coords1, ...coords2];
            }
            return null;
        }
        
        // –ü–æ–∏—Å–∫ —Å–∏–º–≤–æ–ª–∞ –≤ –æ–¥–Ω–æ–º –∫—É–±–µ
        function findCharInCube(char, cube) {
            for (let x = 0; x < 3; x++) {
                for (let y = 0; y < 3; y++) {
                    for (let z = 0; z < 3; z++) {
                        if (cube[x][y][z] === char) {
                            return [x, y, z];
                        }
                    }
                }
            }
            return null;
        }
        
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        function decrypt() {
            initCubes();
            const text = document.getElementById('text-input').value;
            const coordsList = text.split(' ');
            let output = '';
            
            for (const coordsStr of coordsList) {
                const coords = coordsStr.split(',').map(Number);
                if (coords.length === 6) {
                    const [x1, y1, z1, x2, y2, z2] = coords;
                    const char = cube1[x1][y1][z1]; // –∏–ª–∏ cube2[x2][y2][z2]
                    output += char;
                } else {
                    output += '?';
                }
            }
            
            document.getElementById('output').innerHTML = `<strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong> ${output}`;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = initCubes;
    </script>
</body>
</html>
